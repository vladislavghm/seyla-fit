# Генерация админки TinaCMS локально

Админка TinaCMS требует много памяти для генерации, поэтому её лучше генерировать локально и загружать на сервер отдельно.

## Быстрая инструкция

### 1. Генерация админки локально

```bash
# На локальной машине (Windows/Mac/Linux)
bash deploy/build-admin-local.sh
```

Скрипт:

- Проверит наличие `.env.local` с переменными TinaCMS
- Сгенерирует админку в `public/admin`
- Покажет размер и команды для загрузки на сервер

### 2. Загрузка админки на сервер

Выберите один из вариантов:

#### Вариант 1: Через SCP (рекомендуется)

```bash
scp -r public/admin vladhoyl@155.212.188.120:~/seyla-fit/public/
```

#### Вариант 2: Через RSYNC (быстрее для обновлений)

```bash
rsync -avz public/admin/ vladhoyl@155.212.188.120:~/seyla-fit/public/admin/
```

#### Вариант 3: Через Git

Если `public/admin` не в `.gitignore`:

```bash
git add public/admin
git commit -m "Update admin build"
git push
```

Затем на сервере:

```bash
git pull
```

### 3. Деплой на сервере

После загрузки админки запустите деплой:

```bash
bash deploy/deploy.sh
```

Скрипт деплоя:

- ✅ Сгенерирует только клиент TinaCMS (требует меньше памяти)
- ✅ Сохранит существующую админку, если она уже есть
- ✅ Не будет пытаться перегенерировать админку

## Когда нужно обновлять админку?

Обновляйте админку локально и загружайте на сервер, когда:

- Изменилась схема TinaCMS (`tina/config.tsx` или коллекции)
- Обновилась версия TinaCMS
- Нужно обновить интерфейс админки

## Требования

- Локальная машина с достаточным объемом RAM (рекомендуется 8GB+)
- Node.js 18+ и pnpm установлены локально
- Файл `.env.local` с переменными TinaCMS
- Доступ к серверу через SSH

## Устранение проблем

### Ошибка "JavaScript heap out of memory"

Увеличьте лимит памяти в `deploy/build-admin-local.sh`:

```bash
NODE_OPTIONS="--max-old-space-size=8192"  # 8GB вместо 4GB
```

### Админка не работает после загрузки

1. Проверьте права доступа: `chmod -R 755 public/admin`
2. Убедитесь, что путь правильный: `public/admin/index.html` должен существовать
3. Проверьте логи Next.js на сервере
